这份文档整合了《TSAuto设计》的核心玩法机制与《项目技术设计文档_优化版》的先进技术架构。旨在打造一款具备深度策略、高度可扩展性且技术健壮的单机回合制RPG。

------



# TSAuto 综合设计规格说明书 (v1.0)



**项目代号**：TSAuto

**核心理念**：以“Gambit 自定义AI”与“Roguelike 构筑”为玩法内核，以“逻辑与表现分离”为技术基石的跨平台单机RPG。

------



## 第一部分：游戏核心玩法设计 (Gameplay Mechanics)



本部分基于《TSAuto设计》文档，确立游戏的核心体验循环。



### 1. 游戏概况



- **类型**：单机回合制策略 RPG
- **核心体验**：卡牌养成 + 御魂（装备）构筑 + 战斗编程（Gambit）
- **差异化亮点**：彻底解决传统回合制“挂机智障”的痛点，将“配置AI”作为核心玩法之一。



### 2. 角色与养成系统



- **角色设计（式神）**：
  - **零个体值差异**：摒弃繁琐的“刷初始”，同名角色在同星级、同等级下属性完全一致。
  - **进阶模式**：采用经典的“吞噬同类/狗粮”升星机制，解锁等级上限。
- **精力值系统（Stamina Strategy）**：
  - **设计目的**：强制扩展玩家的卡池深度（Box），防止“国家队”通吃所有副本。
  - **疲劳机制**：角色出战消耗精力。低精力状态下属性大幅衰减；精力耗尽无法出战。
  - **恢复途径**：自然时间恢复、后宅/庭院系统挂机恢复、稀有料理瞬间恢复。



### 3. 装备系统：御魂与重铸



- **御魂架构**：
  - **部位**：经典的 1-6 号位设计。
  - **套装**：2件套/4件套触发特殊属性或机制。
- **获取与随机性**：
  - **RNG核心**：掉落时主属性（部分位置）与副属性完全随机。
- **重铸与保底（核心优化）**：
  - **熔炉合成**：回收无用御魂，**必定**产出同星级新御魂，实现资源循环。
  - **词条洗练**：消耗稀有道具锁定并重随单一词条。
  - **属性剪切（大后期）**：允许将极品副属性从一个御魂“剪切”并“粘贴”到另一个御魂上，作为终极追求。



### 4. 战斗系统与自定义AI



- **战斗基础**：
  - **行动机制**：基于速度属性的动态行动条（Action Bar）。
  - **资源机制**：团队共享的能量槽（类似鬼火），限制每回合技能释放频率。
- **Gambit 自定义AI系统（核心玩法）**：
  - **战术板配置**：玩家需为每个角色预设逻辑列表。
  - **逻辑触发**：系统自上而下扫描条件，执行第一条满足条件的动作。
  - **条件示例**：`[友方血量 < 30%]`、`[自身能量 > 5]`、`[敌方存在特定Buff]`。
  - **方案管理**：支持保存多套AI方案（如：日常速刷、高难攻坚、单体BOSS）。



### 5. 游戏模式



- **常规副本**：循环刷取经验、御魂、重铸材料。
- **Roguelike 无尽之塔**：
  - **机制**：不消耗精力，主要检验卡池深度。
  - **状态继承**：血量与存活状态层间继承。
  - **局内构筑**：每层通关三选一随机Buff（如“治疗转护盾”、“暴击溢出转真伤”）。
  - **产出**：最高质量的御魂及属性转移道具。

------



## 第二部分：技术架构设计 (Technical Architecture)



本部分基于《项目技术设计文档_优化版》，确保项目具备高可维护性与跨平台能力。



### 1. 核心架构理念



采用 **界面与逻辑完全分离 (UI-Logic Separation)** 的架构模式，确保核心战斗逻辑不依赖任何特定的 UI 框架（如 React/Vue），便于未来移植或更换引擎。



#### 架构分层示意图



Plaintext

```
[ 表现层 (UI Layer) ]
   Let: React / Vue / Mobile Touch
   只负责渲染画面、播放动画、捕获用户输入
         |
         v
[ 桥接层 (Bridge Layer) ]
   状态同步适配器 (Adapter)
   负责将核心数据转换为 UI 状态，拦截用户操作转发给核心
         |
         v
[ 核心逻辑层 (Core Logic) ]
   纯 TypeScript 环境 (无 UI 依赖)
   包含：战斗引擎、回合管理、伤害计算、AI决策
         |
         v
[ 数据与插件层 (Data & Plugin) ]
   SSOT 类型定义
   动态加载的角色、技能、装备脚本
```



### 2. 目录结构设计



项目结构强调模块化与测试驱动。

- **src/core (核心层)**：
  - **battle/**：包含战斗引擎本体、回合管理器、伤害计算器。
  - **types/**：**单一事实来源 (SSOT)** 的类型定义文件，严禁在其他地方重复定义接口。
  - **plugin-system/**：负责动态加载和验证游戏内容（角色/技能）。
- **src/ui-bridge (桥接层)**：
  - 包含 React 或 Vue 的适配器，使用状态管理库（如 Zustand/Pinia）作为中介。
- **src/plugins (内容层)**：
  - 存放具体的角色数据、技能逻辑、装备定义的 TypeScript 文件，支持热插拔。
- **tests (测试层)**：
  - 严格对应核心层逻辑，包含单元测试与数值边界测试。



### 3. 关键模块技术规范





#### A. 战斗引擎 (Battle Engine)



- **纯逻辑实现**：引擎是一个状态机，管理战斗开始、回合流转、结算等状态。
- **事件驱动**：通过事件总线（EventBus）广播 `TURN_START`（回合开始）、`DAMAGE_DEALT`（造成伤害）等事件，UI 层监听这些事件进行动画表现。
- **回合管理 (TurnManager)**：
  - 实现基于行动条的“跑条”逻辑。
  - 处理复杂的“推条”（击退行动条）和“拉条”（增加行动条）计算。
  - 处理“伪回合”与“额外回合”的逻辑区别。



#### B. 伤害计算 (Damage Calculator)



- **公式实现**：完整复刻阴阳师级别的复杂公式，包含：
  - 基础伤害区（攻击 x 系数）
  - 暴击爆伤区
  - 增伤/易伤区（加法或乘法叠加需严格定义）
  - 防御减免与穿透区（固定穿透与百分比穿透的计算优先级）
- **边界处理**：必须处理防御降为0或负数的情况，以及数值溢出的钳制。



#### C. 插件系统 (Plugin System)



- **热插拔设计**：角色、技能、Buff 均被视为插件。
- **加载机制**：使用动态导入（Dynamic Import）技术加载内容文件。
- **安全性**：内置 `Validator`（验证器），在加载插件时检查数据结构是否符合 SSOT 定义，防止错误数据导致游戏崩溃。



#### D. 术语与配置 (Configuration)



- **术语配置**：所有游戏内名词（如“鬼火”、“御魂”）不在代码中硬编码，而是通过配置文件引用。这既方便国际化，也方便在规避版权风险时进行全局替换。



### 4. 状态同步机制



- **单向数据流**：UI 组件**绝对禁止**直接修改战斗数据。
- **操作流程**：
  1. 玩家点击“释放技能”。
  2. UI 调用 Bridge 层的 `executeAction`。
  3. Core 层接收指令，计算结果，更新内存中的 `BattleState`。
  4. Core 层发出状态变更通知。
  5. Bridge 层获取最新状态，更新 UI store。
  6. UI 组件根据新状态重新渲染。



### 5. 开发流程与测试



- **TDD (测试驱动开发)**：
  - 在编写任何复杂逻辑（如御魂套装效果、AI判定逻辑）前，必须先编写测试用例。
  - 重点测试边界情况（如：濒死触发、多重反击、行动条溢出）。
- **跨平台构建**：
  - **本地模式**：使用 IndexedDB 存储存档。
  - **桌面端**：使用 Tauri 封装，提供高性能原生体验。
  - **移动端**：使用 Capacitor 封装，适配触摸操作。

------



## 第三部分：开发路线图 (Roadmap)



结合玩法优先级与技术依赖关系，制定以下阶段：

1. **原型阶段 (Prototype)**
   - **技术**：搭建核心架构，实现 BattleEngine 与 TurnManager，完成 SSOT 类型定义。
   - **玩法**：实现“1个式神 + 1个木桩”的自动战斗，验证伤害公式与行动条逻辑。
2. **核心循环阶段 (Core Loop)**
   - **技术**：完善插件加载器，实现 UI 桥接层，接入 React 界面。
   - **玩法**：实现 抽卡 -> 编队 -> 战斗 -> 结算 流程。实装精力值系统基础逻辑。
3. **策略填充阶段 (Strategy Implementation)**
   - **技术**：开发 **Gambit AI 编辑器** 的 UI 与底层逻辑解析器。
   - **玩法**：设计并实装多套御魂效果，实现战斗中的 Buff/Debuff 系统。
4. **内容量产与 Roguelike (Content & Mode)**
   - **技术**：优化性能，处理大量 Buff 叠加时的计算开销。
   - **玩法**：开发“无尽之塔”模式，实现层级间的状态继承与随机 Buff 选取。实装御魂重铸/洗练系统。
5. **发布与优化 (Release)**
   - **技术**：进行多端打包（Windows/Android），接入云存档（可选）。
   - **玩法**：数值平衡调整，完善美术资源与音效。